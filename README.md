**ITMOVA** - это Forth-подобный язык программирования для STM32.

Разработан студентами Университета ИТМО:
- Перевозчиков Иван
- Антонов Всеволод
- Неграш Андрей

**Версия:** *1.0*

**Последнее обновление:** *13.05.2023*

# Основные положения
## Типы данных
В ITMOVA реализовано 5 типов данных и 1 тип возвращаемого значения `void`: 

| Название    | Описание                  | Микрокоманда | По умолчанию         | Диапазон данных          |
|-------------|---------------------------|--------------|----------------------|--------------------------|
| **bool**    | логический                | BLN (200)    | FALSE                | TRUE *или* FALSE         |
| **int**     | целочисленный             | INT (201)    | 0                    | $-2^{31}$ ... $2^{31}$   |
| **float**   | число с плавающей точкой  | FLT (202)    | 0.0                  | $-10^{45}$ ... $10^{38}$ |
| **string**  | строковый                 | STR (203)    | "" *(пустая строка)* | a-Z, 0-9, *пробел*       |
| **pointer** | указатель                 | PTR (204)    | -                    | -                        |
| **void**    | метод                     | VOID (205)   | -                    | -                        |

Стоит заметить, что типы `float` и `int` являются несовместимыми (преобразовать один в другой нельзя).

Все типы данных указываются при помощи символа `:` и пишутся в нижнем регистре.

## Регистрозависимость
Язык ITMOVA относится к регистрозависимым языкам программирования.

В `ВЕРХНЕМ` регистре пишутся имена переменных, параметров и некоторые служебные слова.

В `нижнем` регистре пишутся наименования типов данных и имена функций.

## Служебные слова
В данном разделе представлены зарезервированные языком программирования слова, которые нельзя использовать для наименования переменных.

Все служебные слова всегда пишутся в верхнем регистре.

- `MAKE_YOURSELF_GREAT_AGAIN` - начало программы на языке ITMOVA
- `START` - начало блока кода внутри цикла, функции или условного оператора
- `FINISH` - конец блока кода внутри цикла, функции или условного оператора
- `RETURN` - обозначение возвращаемого значения
- `FROM` - обозначение нижней границы цикла from
- `TO` - обозначение верхней границы цикла from
- `WITH` - обозначение шага в цикле from
- `IF` - обозначение условия

# Работа с ITMOVA
## Объявление переменных 
В ITMOVA существует возможность объявлять переменные определённого типа, присваивать им значения и менять его в процессе выполнения программы.

При объявлении переменной ей автоматически присваивается значение по умолчанию (в зависимости от типа). 
Присвоить своё значение во время инициализации переменной нельзя - для этого нужно дополнительно использовать команду assign().

Объявление переменных осуществляется по следующему шаблону: 
```
VAR_NAME_IN_UPPERCASE : TYPE;
```
### Список параметров
- `VAR_NAME_IN_UPPERCASE` - имя переменной строго в верхнем регистре
- `TYPE` - тип переменной

### Пример
```
VARIABLE : float;
```
    
## Объявление функций 
Для написания качественного и читаемого кода в ITMOVA реализована возможность пользоваться не только встроенными в ITMOVA core функциями, но и создавать свои с произвольным функционалом. 

Обратите внимание, что функциям нельзя давать названия, совпадающие с уже существующими в рамках ITMOVA core. 
Также стоит помнить, что все функции должны быть объявлены до точки входа в листинг основной программы, иначе работа с ними будет недоступна.
В завершающей строке кода функции обязательно должен быть RETURN с возвращаемым значением.

Объявление функций осуществляется по следующему шаблону:
```
func_name_in_lowercase (PARAM_NAME_IN_UPPERCASE : TYPE, ...) : FUNC_TYPE
    START
        <code>
    FINISH
```
### Список параметров
- `func_name_in_lowercase` - имя функции в нижнем регистре
- `PARAM_NAME_IN_UPPERCASE` - имя параметра в верхнем регистре
- `TYPE` - тип переменной
- `FUNC_TYPE` - тип возвращаемого функцией значения
- `START`- служебное слово
- `FINISH` - служебное слово
- `RETURN` - служебное слово

### Пример
```
my_sum (A: float, B: float) : float
    START
        RES : float;
        assign(RES, sum(A, B));
        RETURN RES;
    FINISH
```

## Вызов функций 
Чтобы вызвать любую функцию (свою или из ITMOVA core) требуется после точки входа в основной листинг программы прописать с маленькой буквы имя нужной функции.

Обращаем внимание, что функции могут вкладываться друг в друга и, соответственно, использовать возвращаемое значение в качестве своих аргументов.

Вызов функции осуществляется по следующему шаблону:
```
func_name_in_lowercase (PARAM_NAME_IN_UPPERCASE, ...);
```
### Список параметров
- `func_name_in_lowercase` - имя функции в нижнем регистре
- `PARAM_NAME_IN_UPPERCASE` - имя передаваемого параметра в верхнем регистре или передаваемое значение заданного типа

### Примеры
```
print(VARIABLE);

print("this is string");
```

## Цикл from
Цикл from в ITMOVA является упрощённой формой итеративного цикла for, известного по другим языкам программирования.

Обратите внимание, что при передаче в качестве LOWER_BORDER переменной, её значение не будет меняться, так что для счётчика потребуется создать отдельную переменную и увеличивать (или уменьшать) её на необходимое значение

Объявление цикла from осуществляется по следующему шаблону:
```
FROM LOWER_BORDER TO UPPER_BORDER WITH STEP:
    START
        <code>
    FINISH
```
### Список параметров
- `FROM`- служебное слово
- `TO` - служебное слово
- `WITH` - служебное слово
- `LOWER_BORDER` - начальное значение для цикла типа int
- `UPPER_BORDER` - конечное значение для цикла типа int
- `STEP` - шаг увеличения типа int
- `START`- служебное слово
- `FINISH` - служебное слово

### Пример
```
FROM 1 TO 5 WITH 1:
    START
        print("Hello");
    FINISH
```
    
## Условный оператор if 
В ITMOVA реализована возможность работы с условным оператором

Обращаем внимание, что отсутствует привычный блок ELSE. Для реализации данной логики рекомендум использовать повторный IF с таким же параметром, заключённым в функцию not().

Объявление условного оператора осуществляется по следующему шаблону:
```
IF bool_var:
    START
        <code>
    FINISH
```
### Список параметров
- `IF` - служебное слово
- `bool_var` - имя переменной логического типа в верхнем регистре или функция, возвращающая логическое значение
- `START`- служебное слово
- `FINISH` - служебное слово

### Пример
```    
IF less(FIRST, SECOND):
    START
        SECOND = SECOND - FIRST;
    FINISH
```

# Как работает ITMOVA
Работа языка ITMOVA осуществляется по следующим шагам:
1. Написание текста программы на лексике ITMOVA
2. Компиляция текста в байт-код средствами компилятора, реализованного на Java
3. Передача байт-кода интерпретатору, находящемуся на STM32 (написан на C)
4. Выполнение байт-кода на STM32 и получение результатов

## Стеки в ITMOVA
В ITMOVA реализовано 2 стека: стек данных и стек возврата.

## Байт-код
Байт-код представляет собой микрооперацию и её код в виде числа в десятичном виде

### Системные микрокоманды
| Микрокоманда | Код  | Описание                                    |
|--------------|------|---------------------------------------------|
| **exit**     | 0    | точка завершения основной программы         |
| **jmp**      | 1    | переход по абсолютному адресу (переходит по адресу, который лежит в следующей микрокоманде) |
| **jdec**     | 2    | переход с автоматическим декрементом (cмотрит значение, которые лежит по адресу, который лежит в следующей микрокоманде, и если это значение при декременте не равно нулю, переходит по этому адресу) |
| **jret**     | 3    | переход по адресу на вершине стека (получает значение с вершины стека возврата и переходит по этому адресу) |

### Микрооперации для работы с функциями
| Код  | Команда                                          |
|------|--------------------------------------------------|
| 1000 | вызов функции                                    |
| 1001 | возврат из функции к основной программе (RETURN) |

### Микрооперации для работы с переменными
| Код  | Команда |
|------|---------|
| 2000 | bool    |
| 2001 | int     |
| 2002 | float   |
| 2003 | string  |

### [ITMOVA core](https://github.com/IP-13/ITMOVA_for_stm32/wiki/ITMOVA-core)
| Код  | Команда  |
|------|----------|
| F000 | print()  |
| F001 | scanf()  |
| F100 | and()    |
| F101 | or()     |
| F102 | not()    |
| F120 | concat() |
| F121 | substr() |
| F122 | like()   |
| F123 | length() |
| F200 | sum()    |
| F201 | sub()    |
| F202 | mul()    |
| F203 | div()    |
| F204 | min()    |
| F205 | max()    |
| F210 | abs()    |
| F211 | sin()    |
| F212 | cos()    |
| F213 | log()    |
| F214 | pow()    |
| F215 | inc()    |
| F216 | dec()    |
| F220 | random() |
| F221 | pi()     |
| F222 | e()      |

### Дерево байт-кода
Здесь могло быть ваше дерево, но пока здесь только текст.
